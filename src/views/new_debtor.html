<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=divice-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Nuevo deudor</title>
    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
    <main class="container">
        <h2 class=" pt-3 text-center text-white font-weight-bold">NUEVO DEUDOR</h2>
        <div class="container ">
            <div class="row">
                <div class="col-3"></div>
                <div class="col-6">
                    <hr>
                </div>
                <div class="col-3"></div>
            </div>
        </div>
        <form class="p-4" id="form-NewDebtor">
            <div class="form-group">
                <h5 class="text-white">Nombre y Apellido</h5>
                <input class="form-control" type="text" placeholder="Nombre y Apellido" autofocus id="nameDebtor">
            </div>
            <div class="form-group">
                <h5 class="text-white">Descripción</h5>
                <textarea class="form-control" id="descriptionDebtor" rows="3" placeholder="Descripción de deuda"></textarea>
            </div>
            <div class="form-group">
                <h5 class="text-white pt-2">Monto</h5>
                <input class="form-control" aria-label="default input example" type="text" id="montoDebtor" size="21" maxlength="21" onkeypress="mascara(this,cpf)" placeholder="Monto">
            </div>
            <button class="btn boton btn-block  font-weight-bold"> <i class="fas fa-save fa-lg mx-2"></i>GUARDAR</button>
            <div class=" text-center">
                <button type="button" class="btn boton-rojo font-weight-bold mt-2" id="btn-createbase"><i class="fas fa-trash fa-lg mx-2"></i>CANCELAR</button>
            </div>
        </form>
    </main>
    <script src="../js/script.js"></script>
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script defer src="../../fontawesome-free-5.15.3-web/js/all.js"></script>
    <script>
    const { ipcRenderer } = require('electron');
    const sqlite3 = require('sqlite3').verbose();
    const fs = require('fs');
    //const closeWindowDebtor = ipcRenderer.send('debtor:new');
    const formNewDebtor = document.querySelector('#form-NewDebtor');

    /*formNewDebtor.addEventListener("submit", (e) => {
        const nameDebtor = document.querySelector('#nameDebtor').value;
        const descriptionDebtor = document.querySelector('#descriptionDebtor').value;
        const montoDebtor = document.querySelector('#montoDebtor').value;

        const new_Debtor = {
            name: nameDebtor,
            description: descriptionDebtor,
            monto: montoDebtor
        }


        ipcRenderer.send('debtor:new', new_Debtor);

        e.preventDefault();
    });
    */

    //const btnbasedatos = document.querySelector('#btn-createbase');
   function CloseWindow () {
      ipcRenderer.send('debtor:new');
   }

    function CreateDB() {

        const nameDebtor = document.querySelector('#nameDebtor').value;
        const descriptionDebtor = document.querySelector('#descriptionDebtor').value;
        const montoDebtor = document.querySelector('#montoDebtor').value;

        // Creando archivo de base de datos
        var base_datos = new sqlite3.Database('src/db/debtor.db');

        // Espacio para hacer operaciones en base de datos
        base_datos.serialize(function() { 

            // Crear tabla personas
            base_datos.run("CREATE TABLE IF NOT EXISTS debtor (nombre_apellido TEXT, description TEXT, monto TEXT)");

            // Insertando personas
            var stmt = base_datos.prepare("INSERT INTO debtor VALUES (?,?,?)");
            stmt.run(nameDebtor, descriptionDebtor, montoDebtor);
            stmt.finalize();

            // Consultando base de datos
            base_datos.each("SELECT rowid AS id, nombre_apellido FROM debtor", function(err, debtor) {
                console.log(debtor.id + ": " + debtor.nombre_apellido);
            });

        });

        // Cerrando acceso a base de datos
        base_datos.close();
        ipcRenderer.send('debtor:new');
    };

    function InsertDB() {

        const nameDebtor = document.querySelector('#nameDebtor').value;
        const descriptionDebtor = document.querySelector('#descriptionDebtor').value;
        const montoDebtor = document.querySelector('#montoDebtor').value;
        // Creando archivo de base de datos
        var base_datos = new sqlite3.Database('src/db/debtor.db');

        // Espacio para hacer operaciones en base de datos
        base_datos.serialize(function() {

            // Insertando personas
            var stmt = base_datos.prepare("INSERT INTO debtor VALUES (?,?,?)");

            stmt.run(nameDebtor, descriptionDebtor, montoDebtor);
            stmt.finalize();

            // Consultando base de datos
            base_datos.each("SELECT rowid AS id, nombre FROM debtor", function(err, debtor) {
                console.log(debtor.id + ": " + debtor.nombre);
            });

        });

        // Cerrando acceso a base de datos
        base_datos.close();
        ipcRenderer.send('debtor:new');
    };

    formNewDebtor.addEventListener("submit", (e) => {
        if (fs.existsSync('src/db/debtor.db')) {
            InsertDB();


        } else {

            CreateDB();
        }

    });
    </script>
</body>

</html>